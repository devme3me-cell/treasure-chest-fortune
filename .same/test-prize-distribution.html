<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prize Distribution Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1f3a;
      color: #fff;
    }
    h1 {
      color: #d3af4c;
      text-align: center;
    }
    .controls {
      background: #2a3555;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    button {
      background: #d3af4c;
      color: #1a1f3a;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: #e4c05c;
    }
    .results {
      background: #2a3555;
      padding: 20px;
      border-radius: 10px;
    }
    .prize-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin: 5px 0;
      background: #1a1f3a;
      border-radius: 5px;
      border-left: 4px solid #d3af4c;
    }
    .prize-bar {
      height: 20px;
      background: #d3af4c;
      border-radius: 3px;
      margin-top: 5px;
      transition: width 0.3s;
    }
    .stats {
      font-size: 14px;
      color: #a0a0a0;
    }
    .expected {
      color: #5cbb81;
    }
    .actual {
      color: #d3af4c;
    }
    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      text-align: center;
    }
    .status.testing {
      background: #5cbb81;
      color: #1a1f3a;
    }
    .status.complete {
      background: #2a3555;
    }
  </style>
</head>
<body>
  <h1>üé∞ Prize Distribution Test</h1>

  <div class="controls">
    <h3>Test Settings</h3>
    <button onclick="runTest(100)">Test 100 draws</button>
    <button onclick="runTest(1000)">Test 1,000 draws</button>
    <button onclick="runTest(10000)">Test 10,000 draws</button>
    <button onclick="runTest(50000)">Test 50,000 draws</button>
    <button onclick="clearResults()">Clear Results</button>
  </div>

  <div id="status"></div>

  <div class="results">
    <h3>Distribution Results</h3>
    <div id="results"></div>
  </div>

  <script>
    // Prize weights matching the app
    const PRIZE_WEIGHTS = {
      'È¶ñÂÑ≤Èáë5%': 400,   // Base (most frequent)
      'È¶ñÂÑ≤Èáë7%': 20,    // 1/20 chance relative to 5%
      'È¶ñÂÑ≤Èáë10%': 1,    // 1/20 chance relative to 7%
      'È¶ñÂÑ≤Èáë30%': 0,    // Never awarded
      'È¶ñÂÑ≤Èáë50%': 0,    // Never awarded
      'È¶ñÂÑ≤Èáë100%': 0    // Never awarded
    };

    const PRIZES = Object.keys(PRIZE_WEIGHTS);

    // Calculate expected percentages
    const totalWeight = Object.values(PRIZE_WEIGHTS).reduce((a, b) => a + b, 0);
    const expectedPercentages = {};
    PRIZES.forEach(prize => {
      expectedPercentages[prize] = (PRIZE_WEIGHTS[prize] / totalWeight) * 100;
    });

    // Weighted random selection (same as app)
    function selectWeightedPrize() {
      const weightedPrizes = [];

      Object.entries(PRIZE_WEIGHTS).forEach(([prize, weight]) => {
        for (let i = 0; i < weight; i++) {
          weightedPrizes.push(prize);
        }
      });

      const randomIndex = Math.floor(Math.random() * weightedPrizes.length);
      return weightedPrizes[randomIndex];
    }

    function runTest(iterations) {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status testing">üé≤ Testing ${iterations.toLocaleString()} draws...</div>`;

      const counts = {};
      PRIZES.forEach(prize => counts[prize] = 0);

      // Run the test (async to not block UI)
      setTimeout(() => {
        for (let i = 0; i < iterations; i++) {
          const prize = selectWeightedPrize();
          counts[prize]++;
        }

        displayResults(counts, iterations);
        statusDiv.innerHTML = `<div class="status complete">‚úÖ Test complete! ${iterations.toLocaleString()} draws analyzed</div>`;
      }, 10);
    }

    function displayResults(counts, total) {
      const resultsDiv = document.getElementById('results');
      let html = `<div style="margin-bottom: 15px; color: #a0a0a0;">Total draws: ${total.toLocaleString()}</div>`;

      PRIZES.forEach(prize => {
        const count = counts[prize];
        const actualPercentage = (count / total) * 100;
        const expectedPercentage = expectedPercentages[prize];
        const difference = actualPercentage - expectedPercentage;
        const maxWidth = Math.max(...Object.values(counts)) / total * 100;
        const barWidth = (count / total) / (maxWidth / 100) * 100;

        const diffColor = Math.abs(difference) < 0.5 ? '#5cbb81' :
                         Math.abs(difference) < 1.0 ? '#e4c05c' : '#ca5241';

        html += `
          <div class="prize-item">
            <div style="flex: 1;">
              <div style="font-weight: bold; margin-bottom: 5px;">${prize}</div>
              <div class="stats">
                <span class="expected">Expected: ${expectedPercentage.toFixed(2)}%</span> |
                <span class="actual">Actual: ${actualPercentage.toFixed(2)}%</span> |
                <span style="color: ${diffColor}">Diff: ${difference > 0 ? '+' : ''}${difference.toFixed(2)}%</span>
              </div>
              <div class="stats">
                Count: ${count.toLocaleString()} / ${total.toLocaleString()}
                ${PRIZE_WEIGHTS[prize] === 0 ? ' <strong style="color: #ca5241;">(Display Only - Should be 0!)</strong>' : ''}
              </div>
              <div class="prize-bar" style="width: ${barWidth}%;"></div>
            </div>
          </div>
        `;
      });

      // Add summary
      const displayOnlyPrizes = PRIZES.filter(p => PRIZE_WEIGHTS[p] === 0);
      const displayOnlyCounts = displayOnlyPrizes.map(p => counts[p]).reduce((a, b) => a + b, 0);

      html += `
        <div style="margin-top: 20px; padding: 15px; background: #1a1f3a; border-radius: 5px;">
          <h4 style="color: #d3af4c; margin-top: 0;">Validation Summary</h4>
          <div>‚úì Total draws: ${total.toLocaleString()}</div>
          <div>‚úì Display-only prizes awarded: ${displayOnlyCounts} ${displayOnlyCounts === 0 ? '‚úÖ CORRECT' : '‚ùå ERROR!'}</div>
          <div>‚úì È¶ñÂÑ≤Èáë5%: ${counts['È¶ñÂÑ≤Èáë5%']} (${((counts['È¶ñÂÑ≤Èáë5%']/total)*100).toFixed(2)}%)</div>
          <div>‚úì È¶ñÂÑ≤Èáë7%: ${counts['È¶ñÂÑ≤Èáë7%']} (${((counts['È¶ñÂÑ≤Èáë7%']/total)*100).toFixed(2)}%)</div>
          <div>‚úì È¶ñÂÑ≤Èáë10%: ${counts['È¶ñÂÑ≤Èáë10%']} (${((counts['È¶ñÂÑ≤Èáë10%']/total)*100).toFixed(2)}%)</div>
        </div>
      `;

      resultsDiv.innerHTML = html;
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '<p style="color: #a0a0a0; text-align: center;">Run a test to see results</p>';
      document.getElementById('status').innerHTML = '';
    }

    // Initialize
    clearResults();
  </script>
</body>
</html>
